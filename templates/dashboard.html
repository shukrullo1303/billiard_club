{% load static %}
<!DOCTYPE html>
<html>
<head>
    <title>Table Dashboard</title>
    <link rel="stylesheet" type="text/css" href="{% static 'css/dashboard.css' %}">
</head>
<body>
<h1>Table Dashboard</h1>

<div class="table-container">
    {% for table in tables %}
    <div class="table-card {% if table.active_session %}active{% else %}inactive{% endif %}" id="table-{{ table.id }}">
        <div class="table-number">{{ table.number }} - {{ table.table_type }}</div>

        <div class="timer-price">
            <span class="timer" id="timer-{{ table.id }}">
                {% if table.active_session %}
                    {{ table.active_session.start_time|date:"H:i" }}
                {% else %}
                    00:00
                {% endif %}
            </span>
            <span class="price" id="price-{{ table.id }}">
                {% if table.active_session %}
                    {{ table.active_session.total_price|default:"0" }}
                {% else %}
                    0
                {% endif %}
            </span>
        </div>

        <div class="btn-container">
            <button class="btn start" id="start-{{ table.id }}"
                onclick="startSession({{ table.id }})"
                {% if table.active_session %}disabled{% endif %}>
                START
            </button>
            <button class="btn stop" id="stop-{{ table.id }}"
                onclick="stopSession({{ table.id }})"
                {% if not table.active_session %}disabled{% endif %}>
                STOP
            </button>
        </div>

        <div class="session-list-container">
            <ul class="session-list" id="session-list-{{ table.id }}">
                {% for session in unpaid_sessions %}
                    {% if session.table_id == table.id %}
                        <li id="session-{{ session.id }}">
                            {{ forloop.counter }} - {{ table.number }} - {{ session.start_time|date:"H:i" }} - {{ session.end_time|default:"--" }} - {{ session.total_price }}
                            <button onclick="paySession({{ session.id }})">x</button>
                        </li>
                    {% endif %}
                {% endfor %}
            </ul>
        </div>
    </div>
    {% endfor %}
</div>

<h2>Paid Sessions (Today)</h2>
<p id="total-income">Bugungi foyda: {{ total_income }} so'm</p>
<div class="paid-session-list-container">
    <ul class="paid-session-list" id="paid-sessions-list">
        {% for session in paid_sessions %}
            <li>{{ forloop.counter }} - Table {{ session.table_number }} - {{ session.start_time|date:"H:i" }} - {{ session.end_time|date:"H:i" }} - {{ session.total_price }}</li>
        {% empty %}
            <li>Bugun hali toâ€˜lov qilinmagan.</li>
        {% endfor %}
    </ul>
</div>

<script>
const csrftoken = '{{ csrf_token }}';
</script>
<script src="{% static 'js/dashboard.js' %}"></script>
</body>
</html>
